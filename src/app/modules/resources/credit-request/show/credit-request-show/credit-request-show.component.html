<app-dashboard>
    <main class="flex-1 mx-auto">
          <div class=" xl:grid xl:grid-cols-3">
            <div class="xl:pr-8 pb-4">
                    <h2 class="sr-only">{{'Summary'|translate}}</h2>
                    <div class="rounded-lg bg-white shadow-sm ring-1 ring-gray-900/5">
                      <dl class="flex flex-wrap">
                        <div class="mt-2 flex w-full flex-none  pl-2">
                        
                            <dt class="flex-none text-sm font-semibold leading-6 text-gray-900 pr-4">
                              <div class="w-10 h-10 overflow-hidden rounded-sm bg-gray-900">
                                  <svg class="w-6 h-6 shrink-0 m-auto my-2 text-white" fill="none" stroke="currentColor"
                                          stroke-width="1.5" viewBox="0 0 24 24"
                                          xmlns="http://www.w3.org/2000/svg">
                                          <path _ngcontent-frh-c9="" d="M2.25 7.125C2.25 6.504 2.754 6 3.375 6h6c.621 0 1.125.504 1.125 1.125v3.75c0 .621-.504 1.125-1.125 1.125h-6a1.125 1.125 0 01-1.125-1.125v-3.75zM14.25 8.625c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v8.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 01-1.125-1.125v-8.25zM3.75 16.125c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 01-1.125-1.125v-2.25z" stroke-linecap="round" stroke-linejoin="round"></path>                                  </svg>
                              </div>
                            </dt>
                            <dd class="text-sm font-medium leading-6 text-gray-900">{{'Wholesaler'|translate}}</dd>
                        </div>
                        <div class="mt-6 flex w-full flex-none gap-x-4 border-t border-gray-900/5 px-6 pt-6" >
                          <dt class="flex-none">
                            <span class="sr-only">{{'Code Wholesaler'|translate}}</span>
                            <div class="text-sm leading-6 text-gray-500">{{'Code Wholesaler'|translate}}</div>
                          </dt>
                          <dd class="text-sm font-medium leading-6 text-gray-900" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.agent.wholesaler.codeWholesaler}}</dd>
                        </div>
                        <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                          <dt class="flex-none">
                            <span class="sr-only">{{'Activation status'|translate}}</span>
                            <div class="text-sm leading-6 text-gray-500">{{'Wholesaler Activated'|translate}}</div>

                          </dt>
                          <dd class="rounded-md bg-green-50 px-2 py-1 text-xs font-medium" [ngClass]="creditRequest.data.agent.wholesaler.active ? 'text-green-600 ring-1 ring-inset ring-green-600/20' : 'text-red-600 ring-1 ring-inset ring-red-600/20'" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.agent.wholesaler.active}}</dd>
                        </div>
                        <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                          <dt class="flex-none">
                            <span class="sr-only">{{'Operationnal Account'|translate}}</span>
                            <div class="text-sm leading-6 text-gray-500">{{'Operationnal Account'|translate}}</div>
                          </dt>
                          <dd class="text-sm leading-6 text-gray-500" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.agent.wholesaler.aggregatorWholesaler.account.balance}}</dd>
                        </div>
                      </dl>
                     
                    </div>
            </div>
            <div class="xl:pr-8 pb-4">
                <h2 class="sr-only">{{'Summary'|translate}}</h2>
                
                <div class="rounded-lg bg-white shadow-sm ring-1 ring-gray-900/5">
                  <dl class="flex flex-wrap">
                    <div class="mt-2 flex w-full flex-none  pl-2">
                        
                      <dt class="flex-none text-sm font-semibold leading-6 text-gray-900 pr-4">
                        <div class="w-10 h-10 overflow-hidden rounded-sm bg-[#656F8C]">
                            <svg class="w-6 h-6 shrink-0 m-auto my-2 text-white" fill="none" stroke="currentColor"
                                    stroke-width="1.5" viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg">
                                <path d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                      </dt>
                      <dd class="text-sm font-medium leading-6 text-gray-900">{{'Customer'|translate}}</dd>

                    </div>
                    <div class="mt-6 flex w-full flex-none gap-x-4 border-t border-gray-900/5 px-6 pt-6">
                      <dt class="flex-none">
                        <span class="sr-only">{{'Code customer'|translate}}</span>
                        <div class="text-sm leading-6 text-gray-500">{{'Code customer'|translate}}</div>
                      </dt>
                      <dd class="text-sm font-medium leading-6 text-gray-900" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.agent.codeAgent}}</dd>
                    </div>
                    <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                      <dt class="flex-none">
                        <span class="sr-only">{{'Customer description'|translate}}</span>
                        <div class="text-sm leading-6 text-gray-500">{{'Customer description'| translate}}</div>

                      </dt>
                      <dd class="rounded-md bg-green-50 px-2 py-1 text-xs font-medium" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.agent.description}}</dd>
                    </div>
                    <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                      <dt class="flex-none">
                        <span class="sr-only">{{'Account balance'|translate}} </span>
                        <div class="text-sm leading-6 text-gray-500">{{'Account Balance'|translate}}</div>
                      </dt>
                      <dd class="text-sm leading-6 text-gray-500" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.agent.account.balance}}</dd>
                    </div>
                  </dl>
                 
                </div>
            </div>
            <div class="xl:pr-8 pb-4">
                <h2 class="sr-only">{{'Summary'|translate}}</h2>
                <div class="rounded-lg bg-white shadow-sm ring-1 ring-gray-900/5">
                  <dl class="flex flex-wrap">
                    <div class="mt-2 flex w-full flex-none  pl-2">
                        
                        <dt class="flex-none text-sm font-semibold leading-6 text-gray-900 pr-4">
                          <div class="w-10 h-10 overflow-hidden rounded-sm bg-[#D96A88]">
                              <svg class="w-6 h-6 shrink-0 m-auto my-2 text-white" fill="none" stroke="currentColor"
                                      stroke-width="1.5" viewBox="0 0 24 24"
                                      xmlns="http://www.w3.org/2000/svg">
                                      <path _ngcontent-frh-c9="" d="M2.25 7.125C2.25 6.504 2.754 6 3.375 6h6c.621 0 1.125.504 1.125 1.125v3.75c0 .621-.504 1.125-1.125 1.125h-6a1.125 1.125 0 01-1.125-1.125v-3.75zM14.25 8.625c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v8.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 01-1.125-1.125v-8.25zM3.75 16.125c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 01-1.125-1.125v-2.25z" stroke-linecap="round" stroke-linejoin="round"></path>                                  </svg>
                          </div>
                        </dt>
                        <dd class="text-sm font-medium leading-6 text-gray-900">{{'Credit'|translate}}</dd>
                    </div>
                    <div class="mt-6 flex w-full flex-none gap-x-4 border-t border-gray-900/5 px-6 pt-6">
                      <dt class="flex-none">
                        <span class="sr-only">{{'Amount'|translate}}</span>
                        <div class="text-sm leading-6 text-gray-500">{{'Amount'|translate}}</div>
                      </dt>
                      <dd class="text-sm font-medium leading-6 text-gray-900" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.amount}}</dd>
                    </div>
                    <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                      <dt class="flex-none">
                        <span class="sr-only">{{'Recovery amount by period'|translate}}</span>
                        <div class="text-sm leading-6 text-gray-500">{{'Recovery amount by period'|translate}}</div>
                      </dt>
                      <dd class="text-sm leading-6 text-gray-500"*ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.recoveryAmountByPeriod}}</dd>
                    </div>
                    <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                      <dt class="flex-none">
                        <span class="sr-only">{{'Recovery period in days'|translate}}</span>
                        <div class="text-sm leading-6 text-gray-500">{{'Recovery period in days'|translate}}</div>
                      </dt>
                      <dd class="text-sm leading-6 text-gray-500" *ngIf=" creditRequest$ | async as creditRequest else textLoader">{{creditRequest.data.recoveryPeriodInDays}}</dd>
                    </div>
                  </dl>
                 
                </div>
            </div>
          </div>
          <div class="mx-auto ">
              <section aria-labelledby="activity-title" class="mt-8 xl:mt-10">
                <div>
                  <div class="divide-y divide-gray-200">
                    <div class="pb-4">
                      <h2 id="activity-title" class="text-lg font-medium text-gray-900">{{'Validation stages'|translate}}</h2>
                    </div>
                    <div class="pt-6">
                      <!-- Activity feed-->
                      <div class="flow-root">
                        <ul role="list" class="-mb-8" *ngIf="validationOperations$ | async as operations ; else itemsloader">
                          <li *ngFor="let operation of operations.data; let i = index">
                            <div class="relative pb-8">
                              <span *ngIf="i != operations.data.length - 1" class="absolute left-5 top-5 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                              <div class="relative flex items-start space-x-3">
                                <div class="flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 ring-8 ring-white">
                                    <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                      <path fill-rule="evenodd" d="M5.5 3A2.5 2.5 0 003 5.5v2.879a2.5 2.5 0 00.732 1.767l6.5 6.5a2.5 2.5 0 003.536 0l2.878-2.878a2.5 2.5 0 000-3.536l-6.5-6.5A2.5 2.5 0 008.38 3H5.5zM6 7a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <div class="min-w-0 flex-1">
                                  <div>
                                    <div class="text-sm">
                                      <a href="#" class="font-medium text-gray-900 mr-2">{{operation.user}}</a>
                                      <a href="#" class="relative inline-flex items-center rounded-full px-2.5 py-1 text-xs ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                                        <span *ngIf="operation.status =='REJECTED'" class="absolute flex flex-shrink-0 items-center justify-center">
                                          <span class="h-1.5 w-1.5 rounded-full bg-rose-500" aria-hidden="true"></span>
                                        </span>
                                        <span *ngIf="operation.status =='VALIDATED'" class="absolute flex flex-shrink-0 items-center justify-center">
                                          <span class="h-1.5 w-1.5 rounded-full bg-green-500" aria-hidden="true"></span>
                                        </span>
                                        <span class="ml-3 font-semibold text-gray-900">{{operation.status}}</span>
                                      </a>
                                    </div>
                                    <p class="mt-0.5 text-sm text-gray-500">{{operation.validationStage.codeValidationStage}} {{operation.createdAt | date:'dd/MM/yy HH:mm:ss'}}</p>
                                  </div>
                                  <div class="mt-2 text-sm text-gray-700">
                                    <p>{{operation.description}}</p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </li>
                        </ul>
                      </div>
                      <div *ngIf=" creditRequest$ | async as creditRequest else itemsloader" class="mt-6">
                        <div class="relative pb-8" *ngIf="canValidate">
                          <div class="relative flex items-start space-x-3">
                            <div class="flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 ring-8 ring-white">
                                <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                  <path fill-rule="evenodd" d="M5.5 3A2.5 2.5 0 003 5.5v2.879a2.5 2.5 0 00.732 1.767l6.5 6.5a2.5 2.5 0 003.536 0l2.878-2.878a2.5 2.5 0 000-3.536l-6.5-6.5A2.5 2.5 0 008.38 3H5.5zM6 7a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="min-w-0 flex-1">
                              <div>
                                <div class="text-sm">
                                  <a href="#" class="font-medium text-gray-900 mr-2">{{previousStage.codeValidationStage}}</a>
                                </div>
                                <p class="mt-0.5 text-sm text-gray-500"></p>
                              </div>
                              <div class="mt-2 text-sm text-gray-700">
                                <div class="min-w-0 flex-1">
                                  <form [formGroup]="validationForm">
                                    <div>
                                      <label for="comment" class="sr-only">{{'Comment'|translate}}</label>
                                      <textarea  formControlName="description" id="comment" name="comment" rows="3" class="block w-full rounded-md border-0 py-1.5 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-gray-900 sm:text-sm sm:leading-6" placeholder="Leave a comment"></textarea>
                                    </div>
                                    <div class="mt-6 flex items-center justify-end space-x-4">
                                      <button [disabled]="!validationForm.valid" (click)="showValidateDialog = !showValidateDialog" type="button" class="inline-flex justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                                        <svg class="-ml-0.5 h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                                        </svg>
                                        {{'Validate'|translate}}
                                      </button>
                                      <button [disabled]="!validationForm.valid" (click)="showRejectDialog = !showRejectDialog" class="inline-flex items-center justify-center rounded-md bg-red-900 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-900">{{'Reject'|translate}}</button>
                                    </div>
                                  </form>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>           
        </div>
      </main>
</app-dashboard>




<div *ngIf="showRejectDialog" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
      <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6">
        <div class="sm:flex sm:items-start">
          <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
            <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">{{'Reject Credit'| translate}}</h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500">{{'Are you sure you want to reject the credit?. The credit request will be definetly rejected. This action cannot be undone.'|translate}}</p>
            </div>
          </div>
        </div>
        <div class="mt-5 sm:ml-10 sm:mt-4 sm:flex sm:pl-4">
          <button type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:w-auto" (click)="reject()">{{'Reject'|translate}}</button>
          <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:ml-3 sm:mt-0 sm:w-auto" (click)="showRejectDialog = !showRejectDialog">{{'Cancel'|translate}}</button>
        </div>
      </div>
    </div>
  </div>
</div>


<div *ngIf="showValidateDialog" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
      <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6">
        <div class="sm:flex sm:items-start">
          <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
            <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">{{'Validate Credit'|translate}}</h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500">Are you sure you want to validate the credit?. The credit request will pass on next validation step. This action cannot be undone.</p>
            </div>
          </div>
        </div>
        <div class="mt-5 sm:ml-10 sm:mt-4 sm:flex sm:pl-4">
          <button type="button" class="inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 sm:w-auto"(click)="validate()" >Validate</button>
          <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:ml-3 sm:mt-0 sm:w-auto" (click)="showValidateDialog = !showValidateDialog">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>


<ng-template #itemsloader>
  <app-table-loader></app-table-loader>
</ng-template>

<ng-template #textLoader>
  <div class="max-w-sm animate-pulse" role="status">
      <div class="h-3 bg-gray-200 rounded-full dark:bg-gray-700 w-20 mb-2.5"></div>
  </div>
</ng-template>